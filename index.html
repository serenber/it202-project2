<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Chicago's Movies in the Park 2019</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	 crossorigin="anonymous">


	<style>
		.content {
			display: none;
			margin: 1em;
		}
	</style>

</head>

<body>
	<!-- navigation bar -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">Navbar</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#home">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#searchScreen">Search Screen</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#searchScreenResults">Search Results</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#about">About</a>
      </li>
    </ul>
  </div>
  </nav>
    
  <!-- the content divs -->
  <div class="content" id="home">
    Home page<br>
      On the search screen please type in a park name, movie title, or day of the week.<br>
      Then select the corresponding category before clicking search.<br>
  </div>
  <!-- Search Screen div -->
  <div class="content" id="searchScreen">
    This is the search screen
      
      <form>
        <input type="text" placeholder="Find a movie" id="txtSearch">
        <button id="btnSearch">Search</button>
          
        <!-- upcoming movies checkbox, default:checked -->
        <label for="upcoming">
            <input id="upcoming" type="checkbox" name="upcoming" checked> Upcoming
        </label><br>
          
        <!-- Day of the week -->
        <label for="sunday">
            <input id="sunday" type="checkbox" name="day" value="Sun"> Sunday
        </label>
        <label for="monday">
            <input id="monday" type="checkbox" name="day" value="Mon"> Monday
        </label>
          <label for="tuesday">
            <input id="tuesday" type="checkbox" name="day" value="Tue"> Tuesday
        </label>
          <label for="wednesday">
            <input id="wednesday" type="checkbox" name="day" value="Wed"> Wednesday
        </label>
          <label for="thursday">
            <input id="thursday" type="checkbox" name="day" value="Thu"> Thursday
        </label>
          <label for="friday">
            <input id="friday" type="checkbox" name="day" value="Fri"> Friday
        </label>
          <label for="saturday">
            <input id="saturday" type="checkbox" name="day" value="Sat"> Saturday
        </label><br>
         
        <!-- Category Radio buttons -->
        Categories: 
        <label for="park">
            <input id="park" value="park" type="radio" name="category"> Park Name
        </label>
        <label for="movie">
            <input id="movie" value="movie" type="radio" name="category"> Movie Title
        </label>
        <label for="day">
            <input id="day" value="day" type="radio" name="category"> Day of Week
        </label>
          
      </form>
  </div>
  <!-- Results Screen div -->
  <div class="content" id="searchScreenResults">
    This is search results screen
  </div>
  <!-- About Screen div -->
  <div class="content" id="about">
    About 
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
      

  
  <script>
    $(document).ready(function() {

      function hideScreens() {
        $(".content").hide();
      }

      $(".nav-link").on("click", function(){
        hideScreens();
        var target = $(this).attr("href");
        $(target).show();
      });

    });
  </script>

<!-- Style class to modify the look of the results -->
<style>
  .result-text {
    color: black;
  }
</style>
    
    <!-- Script to generate the database search -->
    <script type="text/javascript">
        var endpoint = "https://data.cityofchicago.org/resource/7piw-z6r6.json";
        $(document).ready(function(){
            $("#btnSearch").on("click", function(){
               var categorySearch = $('input[name="category"]:checked').val();
                
               var query = endpoint;
                
               if($('input[name="upcoming"]:checked').val() == "on"){
                   var today = new Date();
                   var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
                   console.log(date);
                   query = query + "?$where= date > '" + date +"'";
//need to add to query s.t. results are after current date
               }
                
               if(categorySearch == "park" || categorySearch == "movie"){
                   query = query + "?" + categorySearch + "=" + $("#txtSearch").val()
               }
               if(categorySearch == "day"){
                   query = query + "?$where=day in(";
                   //get all the checkboxes named day and loop through them, generate our query
                   var checkboxes = document.querySelectorAll('input[name=day]:checked');
                   for (var i=0; i<checkboxes.length; i++) {
                       query = query + "\'" +checkboxes[i].value + "\'";
                       if(i + 1 < checkboxes.length){
                           query = query + ",";
                       }
                   }
                   query = query +")";
               }
               $.get( query, 
                  function(response){
//need to clear the screen then add stuff to it
                   if(response.length == 0){//there's no responses
                       var p = $("<p>");
                        p.text("No Results");
                        $("#searchScreenResults").append(p);
                   }
                    $.each(response, function(i, v){
                        var p = $("<p>");
                        p.addClass("result-text");//style class
                        var date = v.date.slice(0, v.date.search("T"));//clean up the date so it's easier to read
                        p.text(v.park + ": " + date + " " + v.title);
//we'll need to save the park address in here also... I think...
                        $("#searchScreenResults").append(p);
                    });
                }); 
            });
        });
    </script>
  </body>
</html>