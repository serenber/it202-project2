<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Chicago's Movies in the Park 2019</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	 crossorigin="anonymous">


	<style>
		.content {
			display: none;
			margin: 1em;
		}
	</style>

</head>

<body>
	<!-- navigation bar -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">Navbar</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#home">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#searchScreen">Search Screen</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#searchScreenResults">Search Results</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#about">About</a>
      </li>
    </ul>
  </div>
  </nav>
    
  <!-- the content divs -->
  <div class="content" id="home">
    Home page<br>
      On the search screen please type in a park name, movie title, or day of the week.<br>
      Then select the corresponding category before clicking search.<br>
  </div>
  <!-- Search Screen div -->
  <div class="content" id="searchScreen">
    This is the search screen
      
      <form>
        <input type="text" placeholder="Find a movie" id="txtSearch">
        <button id="btnSearch">Search</button>
          
        <!-- upcoming movies checkbox, default:checked -->
        <label for="upcoming">
            <input id="upcoming" type="checkbox" name="upcoming" checked> Upcoming
        </label><br>
          
        <!-- Day of the week -->
        <label for="sunday">
            <input id="sunday" type="checkbox" name="day" value="Sun"> Sunday
        </label>
        <label for="monday">
            <input id="monday" type="checkbox" name="day" value="Mon"> Monday
        </label>
          <label for="tuesday">
            <input id="tuesday" type="checkbox" name="day" value="Tue"> Tuesday
        </label>
          <label for="wednesday">
            <input id="wednesday" type="checkbox" name="day" value="Wed"> Wednesday
        </label>
          <label for="thursday">
            <input id="thursday" type="checkbox" name="day" value="Thu"> Thursday
        </label>
          <label for="friday">
            <input id="friday" type="checkbox" name="day" value="Fri"> Friday
        </label>
          <label for="saturday">
            <input id="saturday" type="checkbox" name="day" value="Sat"> Saturday
        </label><br>
         
        <!-- Category Radio buttons -->
        Categories: 
        <label for="park">
            <input id="park" value="park" type="radio" name="category"> Park Name
        </label>
        <label for="movie">
            <input id="movie" value="movie" type="radio" name="category"> Movie Title
        </label>
        <label for="day">
            <input id="day" value="day" type="radio" name="category"> Day of Week
        </label>
          
      </form>
  </div>
  <!-- Results Screen div -->
  <div class="content" id="searchScreenResults">
    This is search results screen
  </div>
  <!-- About Screen div -->
  <div class="content" id="about">
      <style>
          .larger-text {
          font-size: 20px;
      }
      </style>
    <h1 style="font-weight:bold">About</h1>
    <p class="larger-text">The app name: Chicago's Movies in the Park for 2019</p>
    <p style="color:gray">
        This is in reference to the database that this app is working with.<br>
        It could be changed later to another if you choose :)
    </p>
    <p class="larger-text">Developer: Serena Schultz</p>
    <p class="larger-text">GitHub repo <a href="https://github.com/sschul24/IT202-Proj2" target="_blank">link</a></p>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
      

  
  <script>
    $(document).ready(function() {

      function hideScreens() {
        $(".content").hide();
      }

      $(".nav-link").on("click", function(){
        hideScreens();
        var target = $(this).attr("href");
        $(target).show();
      });

    });
  </script>

<!-- Style class to modify the look of the results -->
<style>
  .result-text {
    color: black;
  }
</style>
    
    <!-- Script to generate the database search -->
    <script type="text/javascript">
        var endpoint = "https://data.cityofchicago.org/resource/7piw-z6r6.json";
        $(document).ready(function(){
            $("#btnSearch").on("click", function(){
               var categorySearch = $('input[name="category"]:checked').val();
                
               var query = endpoint;
                
               //add to query s.t. results are after current date
               if($('input[name="upcoming"]:checked').val() == "on"){
                   var today = new Date();
                   var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
                   console.log(date);
                   query = query + "?$where= date > '" + date +"'";
               }
                
               //figure out what category of search we're doing
               if(categorySearch == "park" || categorySearch == "movie"){
                   if(query.indexOf("?$where") > -1){//check if the query has been started already
                       query = query + "&";
                   }
                   else{
                       query = query + "?";
                   }
                   query = query + categorySearch + "=" + $("#txtSearch").val();
               }
               else if(categorySearch == "day"){
                    if(query.indexOf("?$where") > -1){//check if the query has been started already
                        query = query + "AND day in("
                    }
                   else{
                       query = query + "?$where=day in(";
                   }
                   //get all the checkboxes named day and loop through them, generate our query
                   var checkboxes = document.querySelectorAll('input[name=day]:checked');
                   for (var i=0; i<checkboxes.length; i++) {
                       query = query + "\'" +checkboxes[i].value + "\'";
                       if(i + 1 < checkboxes.length){
                           query = query + ",";
                       }
                   }
                   query = query +")";
               }
               else{
                   //tell the user to pick one
                   $("#searchScreen").append("Please select a category");
               }
               $.get( query, 
                  function(response){
//need to clear the screen then add stuff to it
  //Is there some way to check if there's cards and if there is remove them?
                   if(response.length == 0){//there's no responses
                        var d1 = $("<div>"); d1.addClass("card");
                        var d2 = $("<div>"); d2.addClass("card-body");
                        var h5 = $("<h5>"); h5.addClass("card-title");
                          h5.text("No Results");
                        d2.append(h5);
                        d1.append(d2);
                        $("#searchScreenResults").append(d1);
                   }
                    $.each(response, function(i, v){
                        var date = v.date.slice(0, v.date.search("T"));//clean up the date so it's easier to read
                        var cc;
                        if(v.cc == "Y"){
                            cc = "Closed Captioned";
                        }
                        else{
                            cc = "Not Closed Captioned";
                        }
                        
                        var d1 = $("<div>"); d1.addClass("card");
                        var d2 = $("<div>"); d2.addClass("card-body");
                        var h5 = $("<h5>"); h5.addClass("card-title");
                          h5.text(v.title + " " + date);
                        var h6 = $("<h5>"); h6.addClass("card-subtitle mb-2 text-muted");
                          h6.text("Rating: " + v.rating + " " + cc);
                        var p1 = $("<p>"); p1.addClass("card-text"); p1.addClass("font-weight:bold");
                          p1.text(v.park + " " + v.park_phone + " " + v.park_address);
                        
                        d2.append(h5);
                        d2.append(h6);
                        d2.append(p1);
                        d1.append(d2);
                        $("#searchScreenResults").append(d1);
                        
//I'll want to save the coordinates for when I need to add the markers to the map
  //I can get the coordinates from v.location.latitude and v.location.longitude
  //can I add those directly to the map? or do I need to create a list to iterate over?

//Each record/marker in the info window I'll need (I can just steal the cards... I think)
  //park information
  //movie title
  //date
  //rating
  //whether or not the movie will be closed-captioned
                    });
                }); 
            });
        });
    </script>
  </body>
</html>